# ğŸš€ Cherry Deploy: Delightful Deployment Experience

> **SoftBank Hackathon 2025 - Team Cherry**  
> "Make Deployment Delightful" í…Œë§ˆ í”„ë¡œì íŠ¸

ë°°í¬ë¥¼ **í…Œë§ˆíŒŒí¬ ë†€ì´ê¸°êµ¬ì²˜ëŸ¼** ë§Œë“¤ê¸° - ë¹ ë¥´ê³ , ì•ˆì „í•˜ê³ , ì¬ë¯¸ìˆëŠ” ë°°í¬ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

- [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)
- [í•µì‹¬ ì»¨ì…‰](#-í•µì‹¬-ì»¨ì…‰)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [ì£¼ìš” ê¸°ëŠ¥](#-ì£¼ìš”-ê¸°ëŠ¥)
- [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#-í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [API ëª…ì„¸](#-api-ëª…ì„¸)
- [ê°œë°œ í˜„í™©](#-ê°œë°œ-í˜„í™©)
- [ë°°í¬ ë° ì‹¤í–‰](#-ë°°í¬-ë°-ì‹¤í–‰)
- [í™˜ê²½ ì„¤ì •](#-í™˜ê²½-ì„¤ì •)
- [íŒ€ ì •ë³´](#-íŒ€-ì •ë³´)

---

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

Cherry DeployëŠ” **ë°°í¬ ê²½í—˜ì„ ì¬ì •ì˜**í•˜ëŠ” DevOps ìë™í™” í”Œë«í¼ì…ë‹ˆë‹¤. ê¸°ì¡´ ë°°í¬ì˜ ê³ í†µìŠ¤ëŸ¬ìš´ ê²½í—˜ì„ ì œê±°í•˜ê³ , ê°œë°œìê°€ ìì‹ ê°ì„ ê°€ì§€ê³  ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

### í•´ê²°í•˜ê³ ì í•˜ëŠ” ë¬¸ì œ

#### ê°œë°œìì˜ ê³ í†µ (Pain Points)
- âŒ **ë¡¤ë°±ì´ ëŠë¦¬ê³  ë³µì¡**: ìƒˆ ë²„ì „ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì›ë³µ ì–´ë ¤ì›€
- âŒ **ì‹¤íŒ¨ ì›ì¸ íŒŒì•… ì–´ë ¤ì›€**: ë¡œê·¸ê°€ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì— í©ì–´ì ¸ ìˆìŒ
- âŒ **ë™ì‹œ ë°°í¬ ì¶©ëŒ**: ì—¬ëŸ¬ ëª…ì´ ë°°í¬í•˜ë©´ í™˜ê²½ì´ ê¼¬ì„
- âŒ **ë°°í¬ì— ëŒ€í•œ ê³µí¬**: ì‘ì€ ë³€ê²½ë„ "ë¦´ë¦¬ìŠ¤ = ë¶ˆì•ˆ"ìœ¼ë¡œ ì¸ì‹

#### ì†Œë¹„ìì˜ ë¶ˆí¸
- ğŸ“‰ ë°°í¬ íƒ€ì´ë°ì— ì†ë„ ì €í•˜
- âš ï¸ ë¡¤ë§ ë°°í¬ ì¤‘ ì—ëŸ¬ í˜ì´ì§€ ë…¸ì¶œ
- ğŸ”„ ë²„ì „ ì„ì„ í˜„ìƒ
- â° ê¸°ëŠ¥ ì—…ë°ì´íŠ¸ ì§€ì—°

---

## ğŸ’¡ í•µì‹¬ ì»¨ì…‰

### "Delightful Deploy" ì •ì˜

ë°°í¬ë¥¼ **í…Œë§ˆíŒŒí¬ ë†€ì´ê¸°êµ¬**ì— ë¹„ìœ :

| ë†€ì´ê¸°êµ¬ ê²½í—˜ | ë°°í¬ ì‹œìŠ¤í…œ |
|------------|-----------|
| ï¿½ **ì¤„ì´ ì§§ë‹¤** (ëŒ€ê¸°ì‹œê°„â†“) | í´ë¦­ í•œ ë²ˆì— ë¹ ë¥¸ ë°°í¬ |
| ğŸ”’ **ì•ˆì „ë°” ë‹¨ë‹¨** (ì•ˆì „ì¥ì¹˜â†‘) | ë¬¸ì œ ë°œìƒ ì‹œ ì¦‰ì‹œ ë¡¤ë°± |
| ğŸ“¸ **ì‚¬ì§„/ì„±ì í‘œ ì œê³µ** (ê´€ì¸¡â†‘) | ì „/í›„ ì„±ëŠ¥Â·ë¦¬ì†ŒìŠ¤ ì°¨ì´ í™•ì¸ |
| ğŸ‘¥ **ì¹œêµ¬ë‘ ê°™ì´ íƒ„ë‹¤** (ë™ì‹œì„±â†‘) | ì—¬ëŸ¬ ëª…ì´ ì•ˆì „í•˜ê²Œ í˜‘ì—… |
| ğŸµ **BGM/ì—°ì¶œ** (ì¬ë¯¸â†‘) | "ë˜ ë°°í¬í•˜ê³  ì‹¶ë‹¤"ëŠ” ê°ì • |

### í•µì‹¬ ê°€ì¹˜

> **"ë²„íŠ¼ 1ë²ˆìœ¼ë¡œ ë¹ ë¥´ê³  ì•ˆì „í•˜ë©° ë³´ì´ëŠ” ë³€í™”ê°€ ìˆê³ ,  
> ì—¬ëŸ¿ì´ ì¨ë„ ì•ˆ ë¶€ì„œì§€ë©°, ì‹¬ì§€ì–´ ì¬ë¯¸ê¹Œì§€ ìˆëŠ” ë°°í¬ ê²½í—˜"**

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 2-Repo (Polyrepo) êµ¬ì¡°

í”„ë¡œì íŠ¸ëŠ” **2ê°œì˜ ë…ë¦½ëœ ë¦¬í¬ì§€í† ë¦¬**ë¡œ êµ¬ì„±ë˜ì–´ Git ì¶©ëŒì„ ì›ì²œ ì°¨ë‹¨í•©ë‹ˆë‹¤.

```
/home/ec2-user/projects/
â”œâ”€â”€ SB_Hackathon_Cherry_Chatbot/   # [Repo 1] ë°°í¬ ëŒ€ìƒ (Next.js í”„ë¡ íŠ¸ì—”ë“œ)
â”‚   â””â”€â”€ frontend/my-dashboard/      # Next.js ì•±
â”‚
â””â”€â”€ SB_Hackathon_Cherry_Deploy/     # [Repo 2] ë°°í¬ ì‹œìŠ¤í…œ (ë³¸ í”„ë¡œì íŠ¸)
    â”œâ”€â”€ app_main.py                 # FastAPI ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
    â”œâ”€â”€ api-code/                   # ë°±ì—”ë“œ ì†ŒìŠ¤ì½”ë“œ
    â”œâ”€â”€ mongodb/                    # MongoDB ë°”ì´ë„ˆë¦¬
    â”œâ”€â”€ mongodb-data/               # MongoDB ë°ì´í„° ë””ë ‰í„°ë¦¬
    â””â”€â”€ swagger-api/                # API ë¬¸ì„œ
```

### ì‹œìŠ¤í…œ êµ¬ì„±

```mermaid
graph TB
    A[ìš´ì˜ì] -->|POST /api/v1/deploy| B[Cherry Deploy API]
    B --> C[FastAPI Backend]
    C --> D[MongoDB]
    C --> E[Deploy Service]
    E --> F[Git Operations]
    E --> G[PM2 Process Manager]
    E --> H[Nginx Blue/Green]
    E --> I[Gemini LLM Preview]
    F --> J[Repo 1: Chatbot Frontend]
    G --> K[Next.js Dev Server]
    H --> L[Static Assets]
```

---

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

### 1. ğŸ”„ Blue/Green ë¬´ì¤‘ë‹¨ ë°°í¬

- **Nginx ì‹¬ë³¼ë¦­ ë§í¬ ê¸°ë°˜** Blue/Green ì „í™˜
- ë°°í¬ ì¤‘ ê¸°ì¡´ ë²„ì „ ìœ ì§€ë¡œ **ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤**
- ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì´ì „ ìŠ¬ë¡¯ìœ¼ë¡œ ë¡¤ë°± ê°€ëŠ¥

### 2. ğŸ¤– AI ê¸°ë°˜ ë³€ê²½ì‚¬í•­ í”„ë¦¬ë·°

- **Gemini 2.5 Flash** ëª¨ë¸ì„ í™œìš©í•œ Git diff ë¶„ì„
- ë°°í¬ ì „ ì˜ˆìƒ ë³€ê²½ì‚¬í•­, ìœ„í—˜ìš”ì†Œ, í…ŒìŠ¤íŠ¸ ê¶Œì¥ì‚¬í•­ ìë™ ìƒì„±
- ì½”ìŠ¤íŠ¸ ì¶”ì • ë° ì†Œìš” ì‹œê°„ ì˜ˆì¸¡

### 3. âš¡ ìë™ ë¡¤ë°± (Auto-Recovery)

- `npm install` ë˜ëŠ” PM2 ì‹œì‘ ì‹¤íŒ¨ ì‹œ **ìë™ ë¡¤ë°±**
- ì§ì „ ì„±ê³µ ì»¤ë°‹ìœ¼ë¡œ ìë™ ë³µêµ¬
- ë¡¤ë°± ê³¼ì • ë° ê²°ê³¼ ë©”íƒ€ë°ì´í„°ì— ê¸°ë¡

### 4. ğŸ” ë™ì‹œì„± ì œì–´

- **ì„œë²„ ë ˆë²¨ ë½(AsyncReentrantLock)**ìœ¼ë¡œ ë°°í¬ ì§ë ¬í™”
- ì—¬ëŸ¬ ì‚¬ìš©ìì˜ ë™ì‹œ ë°°í¬ ìš”ì²­ ì¶©ëŒ ë°©ì§€
- Race Condition ì›ì²œ ì°¨ë‹¨

### 5. ï¿½ ì‹¤ì‹œê°„ ë°°í¬ ìƒíƒœ ì¶”ì 

- ë°°í¬ íŒŒì´í”„ë¼ì¸ ê° ë‹¨ê³„ë³„ ìƒíƒœ ëª¨ë‹ˆí„°ë§
- íƒ€ì„ë¼ì¸ ê¸°ë°˜ ì§„í–‰ ìƒí™© í‘œì‹œ
- `/api/v1/status/{task_id}`ë¡œ í´ë§

### 6. ğŸ” ì›í´ë¦­ ë¡¤ë°±

- `/api/v1/rollback` ì—”ë“œí¬ì¸íŠ¸ë¡œ ì¦‰ì‹œ ë¡¤ë°±
- ìµœê·¼ 2ê°œì˜ ì„±ê³µ ë°°í¬ ì´ë ¥ ê¸°ë°˜
- Git ì»¤ë°‹ ë‹¨ìœ„ë¡œ ì •í™•í•œ ë²„ì „ ë³µì›

---

## ï¿½ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Backend
- **FastAPI** - ê³ ì„±ëŠ¥ Python ì›¹ í”„ë ˆì„ì›Œí¬
- **MongoDB (Motor)** - ë¹„ë™ê¸° MongoDB ë“œë¼ì´ë²„
- **Google Gemini API** - AI ê¸°ë°˜ ì½”ë“œ ë¶„ì„
- **asyncio** - ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬

### Frontend (ë°°í¬ ëŒ€ìƒ)
- **Next.js** - React í”„ë ˆì„ì›Œí¬
- **TypeScript** - íƒ€ì… ì•ˆì „ì„±

### Infrastructure
- **AWS EC2** - ì• í”Œë¦¬ì¼€ì´ì…˜ í˜¸ìŠ¤íŒ…
- **Nginx** - ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ & Blue/Green ì „í™˜
- **PM2** - Node.js í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬
- **Let's Encrypt** - HTTPS ì¸ì¦ì„œ
- **Git** - ì†ŒìŠ¤ ì½”ë“œ ê´€ë¦¬

### DevOps
- **Blue/Green Deployment** - ë¬´ì¤‘ë‹¨ ë°°í¬ ì „ëµ
- **Git-based Workflow** - ë¸Œëœì¹˜ ê¸°ë°˜ ë°°í¬ ê´€ë¦¬
- **Subprocess Management** - ëª…ë ¹ì–´ ì‹¤í–‰ ë° ì˜¤ë¥˜ ì²˜ë¦¬

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
SB_Hackathon_Cherry_Deploy/
â”œâ”€â”€ app_main.py                 # FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”œâ”€â”€ requirements.txt            # Python ì˜ì¡´ì„±
â”œâ”€â”€ AGENTS.md                   # ìš´ì˜ ë©”ëª¨
â”œâ”€â”€ developmentplan.html        # ê°œë°œ ì „ëµ ë¬¸ì„œ
â”œâ”€â”€ systemDevPlan.html          # ì‹œìŠ¤í…œ ì„¤ê³„ ë¬¸ì„œ
â”‚
â”œâ”€â”€ api-code/                   # ë°±ì—”ë“œ ì†ŒìŠ¤ì½”ë“œ
â”‚   â”œâ”€â”€ env_loader.py           # í™˜ê²½ë³€ìˆ˜ ë¡œë”
â”‚   â”œâ”€â”€ settings.py             # ì„¤ì • ê´€ë¦¬
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                     # ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”‚   â”œâ”€â”€ mongo.py            # MongoDB ì—°ê²°
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                 # ë„ë©”ì¸ ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ deploy_states.py   # ë°°í¬ ìƒíƒœ ì •ì˜
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                 # ë°ì´í„° ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ deploy.py           # ë°°í¬ íƒœìŠ¤í¬ ëª¨ë¸
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/           # ì €ì¥ì†Œ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ deploy_tasks.py    # MongoDB ë¦¬í¬ì§€í† ë¦¬
â”‚   â”‚   â”œâ”€â”€ in_memory.py        # ì¸ë©”ëª¨ë¦¬ ë¦¬í¬ì§€í† ë¦¬
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ routers/                # API ë¼ìš°í„°
â”‚   â”‚   â”œâ”€â”€ chat.py             # ì±—ë´‡ API
â”‚   â”‚   â”œâ”€â”€ deploy.py           # ë°°í¬ API
â”‚   â”‚   â”œâ”€â”€ health.py           # í—¬ìŠ¤ì²´í¬ API
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                # Pydantic ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”œâ”€â”€ chat.py             # ì±—ë´‡ ìš”ì²­/ì‘ë‹µ
â”‚   â”‚   â”œâ”€â”€ deploy.py           # ë°°í¬ ìš”ì²­/ì‘ë‹µ
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â””â”€â”€ services/               # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚       â”œâ”€â”€ chat_service.py     # Gemini ì±—ë´‡ ì„œë¹„ìŠ¤
â”‚       â”œâ”€â”€ deploy_service.py   # ë°°í¬ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ (1443ì¤„)
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ mongodb/                    # MongoDB ë°”ì´ë„ˆë¦¬ (ë¡œì»¬ ì„¤ì¹˜)
â”‚   â””â”€â”€ bin/
â”‚       â”œâ”€â”€ mongod
â”‚       â””â”€â”€ mongos
â”‚
â”œâ”€â”€ mongodb-data/               # MongoDB ë°ì´í„° ë””ë ‰í„°ë¦¬ (Git ì œì™¸)
â”‚
â”œâ”€â”€ swagger-api/                # API ë¬¸ì„œ
â”‚   â”œâ”€â”€ openapi.yaml            # ì „ì²´ API ìŠ¤í™
â”‚   â”œâ”€â”€ deploy-api.yaml         # ë°°í¬ API ìŠ¤í™
â”‚   â”œâ”€â”€ chat-api.yaml           # ì±—ë´‡ API ìŠ¤í™
â”‚   â”œâ”€â”€ preview-api.yaml        # í”„ë¦¬ë·° API ìŠ¤í™
â”‚   â””â”€â”€ status-api.yaml         # ìƒíƒœ API ìŠ¤í™
â”‚
â””â”€â”€ tests/                      # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
    â””â”€â”€ test_deploy_service.py  # DeployService í…ŒìŠ¤íŠ¸
```

---

## ğŸ“¡ API ëª…ì„¸

### Base URL
- **Production**: `https://delight.13-125-116-92.nip.io`
- **Local**: `http://127.0.0.1:9001`

### ë°°í¬ API

#### POST `/api/v1/deploy`
ìƒˆë¡œìš´ ë°°í¬ íŠ¸ë¦¬ê±°

**Request Body:**
```json
{
  "branch": "deploy"  // ê¸°ë³¸ê°’: "deploy", í—ˆìš©: "deploy", "main"
}
```

**Response (202 Accepted):**
```json
{
  "task_id": "fd2c3a1d8f1f4d59b6d3f6c5d30d2f7a",
  "status": "pending",
  "branch": "deploy",
  "action": "deploy",
  "queued_at": "2025-11-07T10:30:00+09:00",
  "estimated_duration_minutes": 8,
  "dev_server_restart_planned": true
}
```

#### GET `/api/v1/status/{task_id}`
ë°°í¬ ì‘ì—… ìƒíƒœ ì¡°íšŒ

**Response:**
```json
{
  "task_id": "...",
  "status": "running_build",
  "metadata": {...},
  "stages": {
    "running_clone": {...},
    "running_build": {...}
  },
  "started_at": "2025-11-07T10:30:00+09:00",
  "completed_at": null,
  "cost_estimate": {...},
  "risk_assessment": {...},
  "llm_preview": {...}
}
```

#### POST `/api/v1/rollback`
ì´ì „ ë°°í¬ë¡œ ë¡¤ë°±

**Request Body:**
```json
{
  "branch": "deploy"  // ì„ íƒì‚¬í•­
}
```

**Response (202 Accepted):**
```json
{
  "task_id": "...",
  "status": "pending",
  "branch": "deploy",
  "action": "rollback",
  "context": {
    "from_commit": "abc123...",
    "to_commit": "def456..."
  }
}
```

#### GET `/api/v1/preview`
ë°°í¬ ì „ ë¯¸ë¦¬ë³´ê¸°

**Response:**
```json
{
  "current_branch": "deploy",
  "risk_assessment": {
    "risk_level": "medium",
    "files_changed": 12
  },
  "cost_estimate": {
    "runtime_minutes": 8,
    "hourly_cost": 1.33
  },
  "llm_preview": {
    "summary": "Updates to frontend components...",
    "highlights": ["..."],
    "risks": ["..."]
  },
  "timeline_preview": [...]
}
```

#### GET `/api/v1/tasks/recent`
ìµœê·¼ ë°°í¬ ì´ë ¥ ì¡°íšŒ

**Query Params:**
- `limit`: ì¡°íšŒí•  íƒœìŠ¤í¬ ìˆ˜ (ê¸°ë³¸: 5, ìµœëŒ€: 20)

#### GET `/api/v1/tasks/{task_id}/logs`
íŠ¹ì • ë°°í¬ì˜ ìƒì„¸ ë¡œê·¸

### ì±—ë´‡ API

#### POST `/api/v1/chat`
Gemini ì±—ë´‡ê³¼ ëŒ€í™”

**Request Body:**
```json
{
  "message": "ì•ˆë…•í•˜ì„¸ìš”"
}
```

**Response:**
```json
{
  "reply": "ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
  "model": "gemini-2.5-flash"
}
```

### í—¬ìŠ¤ì²´í¬ API

#### GET `/healthz`
ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸

---

## ğŸš€ ê°œë°œ í˜„í™©

### âœ… ì™„ë£Œëœ ê¸°ëŠ¥

#### 1. í•µì‹¬ ë°°í¬ íŒŒì´í”„ë¼ì¸ (100% ì™„ë£Œ)
- [x] Git í´ë¡ /ì²´í¬ì•„ì›ƒ ë‹¨ê³„ (`running_clone`)
- [x] ë¹Œë“œ ë‹¨ê³„ (`running_build`)
- [x] Blue/Green ì»·ì˜¤ë²„ ë‹¨ê³„ (`running_cutover`)
- [x] ê´€ì¸¡ì„± ë‹¨ê³„ (`running_observability`)
- [x] 4ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ ìƒíƒœ ê´€ë¦¬

#### 2. ë°°í¬ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ (100% ì™„ë£Œ)
- [x] `DeployService` í•µì‹¬ ë¡œì§ (1,443ì¤„)
- [x] ë¹„ë™ê¸° íƒœìŠ¤í¬ ì‹¤í–‰ (BackgroundTasks)
- [x] ì„œë²„ ë ˆë²¨ ë½ êµ¬í˜„ (`AsyncReentrantLock`)
- [x] ëª…ë ¹ì–´ ì‹¤í–‰ ë° ì—ëŸ¬ í•¸ë“¤ë§
- [x] Dry-run ëª¨ë“œ ì§€ì›

#### 3. ìë™ ë¡¤ë°± ì‹œìŠ¤í…œ (100% ì™„ë£Œ)
- [x] ì‹¤íŒ¨ ê°ì§€ ë¡œì§
- [x] ìë™ ë³µêµ¬ íŠ¸ë¦¬ê±°
- [x] ì§ì „ ì„±ê³µ ì»¤ë°‹ ê¸°ë°˜ ë¡¤ë°±
- [x] ë¡¤ë°± ê²°ê³¼ ë©”íƒ€ë°ì´í„° ê¸°ë¡
- [x] `failure_context.auto_recovery` ì¶”ì 

#### 4. AI ê¸°ë°˜ í”„ë¦¬ë·° (100% ì™„ë£Œ)
- [x] Gemini 2.5 Flash í†µí•©
- [x] Git diff ë¶„ì„ ë° ìš”ì•½
- [x] ë³€ê²½ì‚¬í•­ í•˜ì´ë¼ì´íŠ¸ ì¶”ì¶œ
- [x] ìœ„í—˜ë„ í‰ê°€ (low/medium/high)
- [x] í…ŒìŠ¤íŠ¸ ê¶Œì¥ì‚¬í•­ ìƒì„±

#### 5. ë°ì´í„°ë² ì´ìŠ¤ (100% ì™„ë£Œ)
- [x] MongoDB í†µí•© (Motor)
- [x] `deploy_tasks` ì»¬ë ‰ì…˜ ìŠ¤í‚¤ë§ˆ
- [x] ì¸ë±ì‹± ë° ì¿¼ë¦¬ ìµœì í™”
- [x] ì¸ë©”ëª¨ë¦¬ í´ë°± ë¦¬í¬ì§€í† ë¦¬
- [x] ìµœê·¼ ì„±ê³µ ë°°í¬ ì¡°íšŒ

#### 6. API ì—”ë“œí¬ì¸íŠ¸ (100% ì™„ë£Œ)
- [x] `POST /api/v1/deploy`
- [x] `POST /api/v1/rollback`
- [x] `GET /api/v1/status/{task_id}`
- [x] `GET /api/v1/preview`
- [x] `GET /api/v1/tasks/recent`
- [x] `GET /api/v1/tasks/{task_id}/logs`
- [x] `POST /api/v1/chat` (Gemini ì±—ë´‡)
- [x] `GET /healthz`

#### 7. ì¸í”„ë¼ ì„¤ì • (100% ì™„ë£Œ)
- [x] EC2 í™˜ê²½ êµ¬ì„± (IP: 13.125.116.92)
- [x] Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •
- [x] HTTPS (Let's Encrypt) ì ìš©
- [x] ë„ë©”ì¸: `delight.13-125-116-92.nip.io`
- [x] PM2 í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ (`main-api`)
- [x] MongoDB ë¡œì»¬ ì„¤ì¹˜ ë° ì‹¤í–‰

#### 8. ë¸Œëœì¹˜ ì „ëµ (100% ì™„ë£Œ)
- [x] 2-Repo êµ¬ì¡° í™•ë¦½
- [x] `deploy` ë¸Œëœì¹˜ ê¸°ë³¸ê°’
- [x] `main` ë¸Œëœì¹˜ ì˜µì…˜ ì§€ì›
- [x] ë¸Œëœì¹˜ ê²€ì¦ ë¡œì§
- [x] Git ì¶©ëŒ ë°©ì§€ ì„¤ê³„

#### 9. ë¬¸ì„œí™” (100% ì™„ë£Œ)
- [x] Swagger/OpenAPI ìŠ¤í™ (`swagger-api/`)
- [x] ê°œë°œ ì „ëµ ë¬¸ì„œ (`developmentplan.html`)
- [x] ì‹œìŠ¤í…œ ì„¤ê³„ ë¬¸ì„œ (`systemDevPlan.html`)
- [x] ìš´ì˜ ê°€ì´ë“œ (`AGENTS.md`)
- [x] API ë¬¸ì„œ (5ê°œ YAML íŒŒì¼)

#### 10. í…ŒìŠ¤íŠ¸ (90% ì™„ë£Œ)
- [x] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ (`test_deploy_service.py`)
- [x] ì¸ë©”ëª¨ë¦¬ ë¦¬í¬ì§€í† ë¦¬ ëª© êµ¬í˜„
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì¶”ê°€ ì˜ˆì •

### ğŸ”§ í˜„ì¬ ê°œë°œ ì¤‘ / í–¥í›„ ê³„íš

#### Phase 2 (ì„ íƒì‚¬í•­)
- [ ] Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- [ ] Grafana ëŒ€ì‹œë³´ë“œ
- [ ] Slack/Discord ì•Œë¦¼ í†µí•©
- [ ] Lighthouse ì„±ëŠ¥ ì¸¡ì •
- [ ] ë°°í¬ ì¼ì • ì˜ˆì•½ ê¸°ëŠ¥

---

## ğŸ¬ ë°°í¬ íŒŒì´í”„ë¼ì¸ íë¦„

### 1. íŠ¸ë¦¬ê±° (Trigger)
```
ìš´ì˜ì â†’ POST /api/v1/deploy â†’ FastAPI
```

### 2. Git ë™ê¸°í™” (`running_clone`)
```bash
git fetch origin
git checkout -B deploy origin/deploy
git reset --hard origin/deploy
git clean -fdx
```

### 3. ë¹Œë“œ (`running_build`)
```bash
cd /home/ec2-user/projects/SB_Hackathon_Cherry_Chatbot/frontend/my-dashboard
npm install
pm2 start npm --name frontend-dev -- run dev
```

### 4. ì»·ì˜¤ë²„ (`running_cutover`)
```bash
# Dev ì„œë²„ ëª¨ë“œì—ì„œëŠ” ìŠ¤í‚µ
# ì •ì  ë¹Œë“œ ì‹œ:
cp -r out/ /var/www/cherry-deploy/blue
ln -sfn blue /var/www/cherry-deploy/current
sudo systemctl reload nginx
```

### 5. ê´€ì¸¡ì„± (`running_observability`)
```bash
# Geminië¡œ Git diff ìš”ì•½ ìƒì„±
# PM2 ìƒíƒœ í™•ì¸
# í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
```

### 6. ì™„ë£Œ (`completed`)
```
ë©”íƒ€ë°ì´í„° ì €ì¥ â†’ MongoDB
ì»¤ë°‹ ì •ë³´, ì‘ì—…ì, íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë¡
```

---

## ğŸ’» ë°°í¬ ë° ì‹¤í–‰

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

```bash
# Python 3.12
python --version

# Node.js & npm
node --version
npm --version

# PM2
npm install -g pm2

# Nginx
sudo systemctl status nginx

# MongoDB (ë¡œì»¬ ì„¤ì¹˜ë¨)
./mongodb/bin/mongod --version
```

### ì„¤ì¹˜ ë° ì‹¤í–‰

#### 1. ë¦¬í¬ì§€í† ë¦¬ í´ë¡ 
```bash
cd /home/ec2-user/projects
git clone <repo-url> SB_Hackathon_Cherry_Deploy
cd SB_Hackathon_Cherry_Deploy
```

#### 2. Python ì˜ì¡´ì„± ì„¤ì¹˜
```bash
pip install -r requirements.txt
```

#### 3. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
```bash
cp .env.example .env
# .env íŒŒì¼ í¸ì§‘í•˜ì—¬ GEMINI_API_KEY ë“± ì„¤ì •
```

#### 4. MongoDB ì‹œì‘
```bash
./mongodb/bin/mongod \
  --dbpath mongodb-data \
  --bind_ip 127.0.0.1 \
  --port 27017 \
  --fork \
  --logpath mongodb-data/mongod.log
```

#### 5. FastAPI ì„œë²„ ì‹œì‘ (PM2)
```bash
pm2 start "uvicorn app_main:app --host 0.0.0.0 --port 9001" --name main-api
pm2 save
```

#### 6. ë¶€íŒ… ì‹œ ìë™ ì‹œì‘ ì„¤ì •
```bash
sudo env PATH=$PATH:/usr/bin \
  /usr/lib/node_modules/pm2/bin/pm2 startup systemd \
  -u ec2-user --hp /home/ec2-user
```

#### 7. Nginx ì„¤ì • í™•ì¸
```bash
sudo nginx -t
sudo systemctl reload nginx
```

### ì„œë¹„ìŠ¤ í™•ì¸

```bash
# PM2 í”„ë¡œì„¸ìŠ¤ ìƒíƒœ
pm2 status

# API í—¬ìŠ¤ì²´í¬
curl https://delight.13-125-116-92.nip.io/healthz

# ë¡œê·¸ í™•ì¸
pm2 logs main-api
```

---

## âš™ï¸ í™˜ê²½ ì„¤ì •

### í™˜ê²½ë³€ìˆ˜ (.env)

```bash
# Gemini API
GEMINI_API_KEY=your_gemini_api_key_here

# MongoDB
MONGODB_URI=mongodb://127.0.0.1:27017
MONGODB_DB_NAME=cherry_deploy

# ë¦¬í¬ì§€í† ë¦¬ ê²½ë¡œ
CHATBOT_REPO_PATH=/home/ec2-user/projects/SB_Hackathon_Cherry_Chatbot

# Nginx Blue/Green ê²½ë¡œ
NGINX_GREEN_PATH=/var/www/cherry-deploy/green
NGINX_BLUE_PATH=/var/www/cherry-deploy/blue
NGINX_LIVE_SYMLINK=/var/www/cherry-deploy/current

# ë°°í¬ ì„¤ì •
DEPLOY_DRY_RUN=false
DEPLOY_DEFAULT_BRANCH=deploy
DEPLOY_ALLOWED_BRANCHES=deploy,main

# í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •
FRONTEND_PROJECT_SUBDIR=frontend/my-dashboard
FRONTEND_INSTALL_COMMAND=npm install
FRONTEND_BUILD_COMMAND=bash -lc "npm run build"
FRONTEND_EXPORT_COMMAND=npm run export
FRONTEND_BUILD_OUTPUT_SUBDIR=out

# LLM í”„ë¦¬ë·° ì„¤ì •
PREVIEW_LLM_MODEL=gemini-2.5-flash
PREVIEW_DIFF_MAX_CHARS=8000

# ë””ìŠ¤í”Œë ˆì´ ì„¤ì •
DISPLAY_TIMEZONE=Asia/Seoul
```

### PM2 ìƒíƒœê³„ íŒŒì¼ (ecosystem.config.js)

```javascript
module.exports = {
  apps: [{
    name: 'main-api',
    script: 'uvicorn',
    args: 'app_main:app --host 0.0.0.0 --port 9001',
    interpreter: 'python3',
    env: {
      DEPLOY_DRY_RUN: 'false',
    }
  }]
};
```

---

## ğŸ¯ í•µì‹¬ ë°ëª¨ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: Blue/Green ë¬´ì¤‘ë‹¨ ë°°í¬
1. í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ ë³€ê²½ í›„ Repo1 `deploy` ë¸Œëœì¹˜ì— í‘¸ì‹œ
2. `POST /api/v1/deploy` í˜¸ì¶œ
3. Green â†’ Blue ë˜ëŠ” Blue â†’ Greenìœ¼ë¡œ ìë™ ì „í™˜
4. ì‚¬ìš©ìëŠ” ë°°í¬ ì¤‘ì—ë„ ê¸°ì¡´ ë²„ì „ ì‚¬ìš© ê°€ëŠ¥
5. ìƒˆ ë²„ì „ í™œì„±í™” í›„ ì¦‰ì‹œ íŠ¸ë˜í”½ ì „í™˜

### ì‹œë‚˜ë¦¬ì˜¤ 2: AI ê¸°ë°˜ ë³€ê²½ì‚¬í•­ í”„ë¦¬ë·°
1. `GET /api/v1/preview` í˜¸ì¶œ
2. Geminiê°€ Git diff ë¶„ì„
3. ë³€ê²½ì‚¬í•­ ìš”ì•½, ìœ„í—˜ë„, í…ŒìŠ¤íŠ¸ ê¶Œì¥ì‚¬í•­ í‘œì‹œ
4. ì˜ˆìƒ ì†Œìš” ì‹œê°„ ë° ë¹„ìš© í™•ì¸
5. ì•ˆì „í•˜ê²Œ ë°°í¬ ì§„í–‰

### ì‹œë‚˜ë¦¬ì˜¤ 3: ìë™ ë¡¤ë°±
1. ë°°í¬ ì¤‘ `npm install` ì‹¤íŒ¨
2. ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ì§ì „ ì„±ê³µ ì»¤ë°‹ ê°ì§€
3. ìë™ ë¡¤ë°± íŠ¸ë¦¬ê±°
4. Git reset, npm install, PM2 ì¬ì‹œì‘
5. `failure_context.auto_recovery`ì— ê²°ê³¼ ê¸°ë¡

---

## ğŸ“Š ê°œë°œ í†µê³„

- **ì´ ì½”ë“œ ë¼ì¸**: ~3,500+ ì¤„
- **í•µì‹¬ ì„œë¹„ìŠ¤ (`deploy_service.py`)**: 1,443 ì¤„
- **API ì—”ë“œí¬ì¸íŠ¸**: 8ê°œ
- **ë°°í¬ íŒŒì´í”„ë¼ì¸ ë‹¨ê³„**: 4ë‹¨ê³„
- **ì§€ì› ë¸Œëœì¹˜**: 2ê°œ (deploy, main)
- **í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**: 340+ ì¤„

---

## ğŸ’ íŒ€ ì •ë³´

**Team Cherry** - SoftBank Hackathon 2025

### í”„ë¡œì íŠ¸ ë‹´ë‹¹
- **Backend MVP**: sungwoo (`sungwoo/feature/backend-mvp` ë¸Œëœì¹˜)
- **Infrastructure**: AWS EC2, Nginx, MongoDB, PM2 ì„¤ì •
- **AI Integration**: Gemini 2.5 Flash í†µí•©

### ì—°ë½ì²˜
- **ì„œë²„**: EC2 Public IP `13.125.116.92`
- **ë„ë©”ì¸**: `delight.13-125-116-92.nip.io`
- **Repository**: `sungwoocse/SB_Hackathon_Cherry_Deploy`

---

## ğŸ“š ì¶”ê°€ ë¬¸ì„œ

- [AGENTS.md](./AGENTS.md) - ìš´ì˜ ê°€ì´ë“œ ë° ëª…ë ¹ì–´
- [developmentplan.html](./developmentplan.html) - ê°œë°œ ì „ëµ ë° ë¬¸ì œ ì •ì˜
- [systemDevPlan.html](./systemDevPlan.html) - ì‹œìŠ¤í…œ ì„¤ê³„ ë° ì•„í‚¤í…ì²˜
- [swagger-api/openapi.yaml](./swagger-api/openapi.yaml) - ì „ì²´ API ìŠ¤í™
- [tests/test_deploy_service.py](./tests/test_deploy_service.py) - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

---

## ğŸ‰ ê²°ë¡ 

Cherry DeployëŠ” **ë°°í¬ë¥¼ ì¦ê±°ìš´ ê²½í—˜ìœ¼ë¡œ ë§Œë“œëŠ”** ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

- âœ… **Fast**: í´ë¦­ í•œ ë²ˆì— ë¹ ë¥¸ ë°°í¬
- âœ… **Safe**: ìë™ ë¡¤ë°±ê³¼ Blue/Green ì „í™˜
- âœ… **Observable**: AI ê¸°ë°˜ í”„ë¦¬ë·°ì™€ ì‹¤ì‹œê°„ ìƒíƒœ ì¶”ì 
- âœ… **Collaborative**: ë™ì‹œì„± ì œì–´ë¡œ ì•ˆì „í•œ í˜‘ì—…
- âœ… **Delightful**: "ë˜ ë°°í¬í•˜ê³  ì‹¶ë‹¤"ëŠ” ê²½í—˜

> **"Make Deployment Delightful"** ğŸš€

---

**Last Updated**: 2025-11-07  
**Version**: 0.1.0 (MVP)  
**Status**: Production Ready âœ¨
