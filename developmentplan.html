<div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; padding: 20px; max-width: 800px; margin: auto; background-color: #ffffff; color: #333;">

    <h1 style="border-bottom: 2px solid #000; padding-bottom: 10px; font-size: 28px;">
        🚀 SoftBank Hackathon: "Delightful Deploy" Cherry팀 전략
    </h1>

    <h2 style="font-size: 24px; margin-top: 30px;">1. 배경 연구: 배포의 "고통" (Pain Points)</h2>
    <p style="font-size: 16px; color: #555;">(회의 주제였던 "개발자와 소비자가 겪는 배포 문제" 리서치입니다. 이 문제를 해결하는 것이 우리 해커톤의 목표입니다.)</p>

    <h3 style="font-size: 19px; margin-top: 25px; margin-bottom: 10px;">(A) "AWS 개발자"가 겪는 고통 (엔지니어 시점)</h3>
    <p style="margin: 0 0 15px 0;">핵심: <strong>fast 하면 unsafe해지고, safe 하려면 느려진다.</strong> "fast AND safe" 둘 다 잡는 장치가 필요합니다.</p>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>롤백이 느리고 복잡:</strong> 새 버전이 터졌을 때 즉시 원복이 어렵습니다.</li>
        <li><strong>실패 원인 파악이 어려움:</strong> 로그가 여러 서비스에 흩어져 추적이 어렵습니다.</li>
        <li><strong>동시 배포 충돌:</strong> 여러 명이 동시에 배포하면 환경이 꼬입니다 (Race Condition).</li>
        <li><strong>Secret 관리의 위험:</strong> <code>.env</code> 파일이나 키 관리가 실수하기 쉽습니다.</li>
        <li><strong>환경 차이로 인한 오류:</strong> 로컬/Staging/Prod 환경이 달라 예측 불가능한 버그가 생깁니다.</li>
        <li><strong>배포에 대한 공포:</strong> 작은 변경이라도 "릴리스 = 고통/불안"으로 인식됩니다.</li>
    </ul>

    <h3 style="font-size: 19px; margin-top: 25px; margin-bottom: 10px;">(B) "일반 소비자"가 느끼는 불편 (소비자 시점)</h3>
    <p style="margin: 0 0 15px 0;">핵심: <strong>사람은 "버전 전환"을 느끼면 불편합니다.</strong> 배포는 "아무 일도 없었던 것처럼" 뒤에서 바뀌어야 합니다.</p>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>순간적인 속도 저하:</strong> 배포 타이밍에 앱이 느려집니다.</li>
        <li><strong>순간적인 에러 발생:</strong> 롤링 배포 중간에 에러 페이지가 노출됩니다.</li>
        <li><strong>기능/버전 섞임:</strong> 캐시나 지역별 배포 차이로 버전이 섞여 보입니다.</li>
        <li><strong>새 기능 업데이트 지연:</strong> 릴리스가 제때 안 되거나 장애 공지가 없습니다.</li>
    </ul>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 24px; margin-top: 30px;">2. 우리의 정의: "Delightful Deploy"란 무엇인가?</h2>
    <p style="font-size: 16px; font-style: italic; color: #555;">(이 정의는 위 1번의 문제들을 해결하며, 심사기준 4가지: 클라우드 활용/완성도/재미/팀개발을 모두 충족합니다.)</p>

    <h3 style="font-size: 19px; margin-top: 25px; margin-bottom: 10px;">(A) 비유: 배포는 테마파크 놀이기구다.</h3>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>줄이 짧다 (대기시간↓):</strong> 클릭 한 번에 빠르게 탑승(배포).</li>
        <li><strong>안전바 단단 (안전장치↑):</strong> 문제 생겨도 즉시 원위치(롤백).</li>
        <li><strong>사진/성적표 제공 (관측↑):</strong> 전/후 성능·리소스 차이를 눈으로 확인.</li>
        <li><strong>친구랑 같이 탄다 (동시성↑):</strong> 여러 명이 동시에 안전하게 탑승(팀 협업/충돌 방지).</li>
        <li><strong>BGM/연출 (재미↑):</strong> "또 타고 싶다"는 감정이 남는다.</li>
    </ul>

    <h3 style="font-size: 19px; margin-top: 25px; margin-bottom: 10px;">(B) 실제 구현 (수정 완료)</h3>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>트리거:</strong> 운영자가 Cherry Deploy API의 <code>/api/v1/deploy</code>를 호출</li>
        <li><strong>자동 흐름:</strong> FastAPI 백엔드가 <code>git fetch → checkout/reset → clean → npm install → pm2 start</code> 순으로 실행하고 (옵션) Nginx 심볼릭 링크를 갱신</li>
        <li><strong>안전장치:</strong> 실패 시 직전 성공 커밋 대상으로 자동 롤백 시도, SSH 키와 환경 변수는 EC2에만 저장</li>
        <li><strong>프리뷰:</strong> Preview API가 최신 성공 배포 대비 git diff를 Gemini 2.5 Flash로 요약해 변경 사항과 리스크를 공유</li>
        <li><strong>동시성:</strong> 배포 락/큐 기능을 서버 측에 도입해 직렬화 (추가 구현 예정)</li>
    </ul>

    <h3 style="font-size: 19px; margin-top: 25px; margin-bottom: 10px;">(C) 1줄 핵심</h3>
    <p style="font-size: 18px; font-weight: 500; background-color: #f4f4f4; padding: 15px; border-radius: 8px;">
        <strong>Delightful Deploy = 버튼 1번으로 빠르고 안전하며 보이는 변화가 있고, 여럿이 써도 안 부서지며, 심지어 재미까지 있는 배포 경험.</strong>
    </p>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 24px; margin-top: 30px;">3. 실행 계획: 기술 스택 및 흐름</h2>
    <p style="font-size: 18px; font-weight: 500; background-color: #f4f4f4; padding: 15px; border-radius: 8px;">
        <strong>"Cherry Deploy API로 오케스트레이션, PM2로 무중단/프로세스 관리"</strong>
    </p>

    <h3 style="font-size: 22px; margin-top: 30px;">🛠️ 핵심 기술 스택</h3>
    <ul>
        <li><strong>지휘 (Orchestration):</strong> Cherry Deploy FastAPI 백엔드</li>
        <li><strong>인프라 (Infra):</strong> AWS EC2 (SSH 기반 관리)</li>
        <li><strong>트래픽 제어 (Gateway):</strong> Nginx (리버스 프록시, Blue/Green 전환용)</li>
        <li><strong>프로세스 관리 (Runner):</strong> PM2 (무중단 재시작)</li>
        <li><strong>변경 요약 (Preview):</strong> Gemini 2.5 Flash를 이용한 git diff 요약</li>
        <li><strong>프론트엔드 타겟:</strong> Next.js 앱 (경로: <code>frontend/my-dashboard</code>). 구조 정비 완료로 <code>npm install</code>, <code>npm run dev</code>, <code>npm run build</code> 실행이 가능.</li>
    </ul>

    <h3 style="font-size: 22px; margin-top: 30px;">🌊 배포 파이프라인 흐름</h3>
    <ol>
        <li><strong>트리거:</strong> 운영자가 Cherry Deploy API의 <code>/api/v1/deploy</code> 엔드포인트를 호출한다.</li>
        <li><strong>저장소 동기화:</strong> 서버 측에서 <code>git fetch → checkout/reset → clean</code> 순으로 Repo1 워킹 디렉터리를 최신화한다.</li>
        <li><strong>빌드/재기동:</strong> <code>npm install</code> 후 PM2로 <code>npm run dev</code>를 백그라운드 실행한다(프로세스명 <code>frontend-dev</code>).</li>
        <li><strong>컷오버:</strong> 정적 산출물이 존재하면 Nginx 심볼릭 링크를 새로운 Green 경로에 맞춰 스왑한다(Blue/Green 전환 고도화 예정).</li>
        <li><strong>프리뷰:</strong> Preview API가 최신 성공 배포 대비 git diff를 요약해 팀원에게 공유한다.</li>
        <li><strong>상태 모니터링:</strong> 클라이언트는 <code>/api/v1/status/{task_id}</code>로 진행 상황과 메타데이터를 폴링한다.</li>
        <li><strong>자동 롤백:</strong> <code>npm install</code> 또는 PM2 단계에서 오류가 발생하면 직전 성공 커밋으로 자동 복구를 시도한다.</li>
    </ol>

    <h3 style="font-size: 22px; margin-top: 30px;">🎯 핵심 데모 포인트 (심사위원 대상)</h3>
    <p>우리는 앱이 아닌, "배포 경험" 3가지를 시연합니다.</p>
    <ol>
        <li><strong>Nginx를 이용한 Blue/Green 배포:</strong> 버튼 하나로 트래픽을 즉시 전환/롤백하는 모습.</li>
        <li><strong>변경 요약 프리뷰:</strong> Preview API가 Gemini 요약으로 변경 위험을 보여주는 모습.</li>
        <li><strong>자동 롤백:</strong> 헬스 체크 실패 시, 시스템이 자동으로 이전 버전으로 복귀하는 모습.</li>
    </ol>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 24px; margin-top: 30px;">4. Q&A (주요 기능 설명)</h2>

    <h4 style="font-size: 18px; margin-bottom: 5px; margin-top: 20px;">Q: 배포는 어떻게 시작하나요?</h4>
    <p style="margin: 0 0 15px 0;">
        A: 운영자는 Cherry Deploy 백엔드의 <code>POST /api/v1/deploy</code> 엔드포인트를 호출하거나, 동일한 명령을 래핑한 스크립트를 통해 배포를 시작합니다. GitHub Actions와 같은 외부 오케스트레이터는 사용하지 않습니다.
    </p>
    <h4 style="font-size: 18px; margin-bottom: 5px; margin-top: 20px;">Q: 롤백은 어떻게 동작하나요?</h4>
    <p style="margin: 0 0 15px 0;">
        A: <code>POST /api/v1/rollback</code>을 호출하면 최근 성공 배포 두 건을 확인해 최신 commit에서 바로 이전 commit으로 되돌립니다. 내부적으로 <code>git fetch</code>, <code>git checkout -B ... to_commit</code>, <code>git reset --hard</code>, <code>git clean -fdx</code>, <code>npm install</code> 후 동일한 PM2 `npm run dev` 명령을 재적용합니다. 실제 모드에서는 <code>git push origin +to_commit:branch</code>로 원격도 강제로 되돌립니다. (TIP: Repo1 <code>deploy</code> 브랜치에는 <code>frontend/my-dashboard</code>만 올려두세요.)</p>

    <h4 style="font-size: 18px; margin-bottom: 5px; margin-top: 20px;">Q: 백엔드 <code>/api/v1/deploy</code> 호출 시 어떤 입력이 필요한가요?</h4>
    <p style="margin: 0 0 15px 0;">
        A: 브랜치를 명시하지 않으면 기본적으로 <code>deploy</code> 브랜치를 사용합니다. 필요하다면 <code>{ "branch": "main" }</code>처럼 허용된 브랜치를 명시적으로 전송할 수도 있습니다. 다른 브랜치는 거부됩니다.
        작업자 추적은 Git 커밋 작성자 정보로 충분하다고 판단했습니다.
    </p>
    <h4 style="font-size: 18px; margin-bottom: 5px; margin-top: 20px;">Q: 테스트 모드(드라이런)와 실제 배포 모드는 어떻게 전환하나요?</h4>
    <p style="margin: 0 0 15px 0;">
        A: 기본값은 실제 명령 실행(<code>DEPLOY_DRY_RUN=false</code>)입니다. 시뮬레이션만 원하면 PM2를 재시작하기 전에 환경변수 <code>DEPLOY_DRY_RUN=true</code>를 설정하세요. MongoDB는 프로젝트 루트의 <code>./mongodb</code>, 데이터는 <code>./mongodb-data</code>에 위치합니다. 실제 배포 모드에서는 <code>git fetch → git checkout -B ... → git reset --hard → git clean -fdx → npm install</code> 순으로 Repo1 워킹 디렉터리를 교체한 뒤 PM2 `npm run dev` 명령을 실행합니다.</p>
    <h4 style="font-size: 18px; margin-bottom: 5px; margin-top: 20px;">Q: Preview API는 어떤 정보를 주나요?</h4>
    <p style="margin: 0 0 15px 0;">
        A: 최신 성공 배포 대비 Git diff를 수집해 Gemini 2.5 Flash 모델로 요약한 변경 사항, 위험 요소, 테스트 권장 사항을 제공합니다. `GEMINI_API_KEY`가 설정돼 있어야 하며 모델은 `PREVIEW_LLM_MODEL`로 변경할 수 있습니다.
    </p>

</div>
