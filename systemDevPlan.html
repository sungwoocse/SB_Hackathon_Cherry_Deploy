<div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; padding: 20px; max-width: 900px; margin: auto; background-color: #ffffff; color: #333; border: 1px solid #ddd;">

    <h1 style="border-bottom: 2px solid #000; padding-bottom: 10px; font-size: 28px;">
        ğŸš€ "Delightful Deploy" API ë°±ì—”ë“œ ìµœì¢… êµ¬í˜„ ê³„íšì„œ (2-Repo)
    </h1>

    <h2 style="font-size: 22px; margin-top: 30px;">1. í•µì‹¬ ì›ì¹™: 2-Repo (Polyrepo) êµ¬ì¡°</h2>
    <p style="font-size: 16px;">
        ìš°ë¦¬ëŠ” 'ë°°í¬ë  ì œí’ˆ'ê³¼ 'ë°°í¬ ë„êµ¬'ë¥¼ <strong>2ê°œì˜ ë…ë¦½ëœ ë¦¬í¬ì§€í† ë¦¬</strong>ë¡œ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ ë°©ì‹ì€ EC2ì—ì„œì˜ ê°œë°œ/ë””ë²„ê¹… ì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” <strong>Git ì¶©ëŒì„ ì›ì²œì ìœ¼ë¡œ ë°©ì§€</strong>í•©ë‹ˆë‹¤.
    </p>
    
    <h3 style="font-size: 19px; margin-top: 25px; margin-bottom: 10px;">EC2 ë¦¬í¬ì§€í† ë¦¬ í´ë” êµ¬ì¡°</h3>
    <pre style="background-color: #f4f4f4; padding: 15px; border-radius: 5px; font-family: monospace;">
/home/ec2-user/projects/
â”‚
â”œâ”€â”€ SB_Hackathon_Cherry_Chatbot/   # &lt;--- (Repo 1) ë°°í¬ë  'ì œí’ˆ' (ì±—ë´‡ í”„ë¡ íŠ¸ì—”ë“œ)
â”‚
â””â”€â”€ SB_Hackathon_Cherry_Deploy/    # &lt;--- (Repo 2) ìš°ë¦¬ì˜ 'ë„êµ¬' (ëª¨ë“  ë°±ì—”ë“œ)
    â”‚
    â”œâ”€â”€ app_main.py                # (DevOps API + ì±—ë´‡ APIê°€ ëª¨ë‘ ì´ íŒŒì¼ì—!)
    â”œâ”€â”€ requirements.txt
    â””â”€â”€ ...
</pre>

    <h2 style="font-size: 22px; margin-top: 30px;">2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (ë‹¨ìˆœí™”ë¨)</h2>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>[ì‹œìŠ¤í…œ 1] ë°°í¬ë  'ìƒ˜í”Œ ì•±' (ì±—ë´‡ í”„ë¡ íŠ¸ì—”ë“œ)</strong>
            <ul>
                <li><strong>ëª©ì :</strong> ë°°í¬/ë¡¤ë°±ì„ ì‹œì—°í•˜ê¸° ìœ„í•œ íƒ€ê²Ÿ.</li>
                <li><strong>ì†ŒìŠ¤ì½”ë“œ:</strong> <code>Repo 1: SB_Hackathon_Cherry_Chatbot</code></li>
                <li><strong>í”„ë ˆì„ì›Œí¬:</strong> Next.js ì•± (ë£¨íŠ¸: <code>frontend/my-dashboard</code>). êµ¬ì¡° ì •ë¹„ ì™„ë£Œë¡œ <code>npm install</code>, <code>npm run build</code>, <code>npm run export</code>ê°€ ë™ì‘í•©ë‹ˆë‹¤.</li>
                <li><strong>ì‹¤í–‰:</strong> [ì‹œìŠ¤í…œ 2]ê°€ <code>npm install â†’ npm run build â†’ npm run export</code>ë¥¼ ì‹¤í–‰í•´ ì •ì  ì‚°ì¶œë¬¼(<code>out/</code>)ì„ ë§Œë“  ë’¤ Blue/Green ìŠ¬ë¡¯ì— ë³µì œí•©ë‹ˆë‹¤. <code>FRONTEND_BUILD_OUTPUT_SUBDIR</code>ë¥¼ ë¹„ìš°ë©´ PM2 `frontend-dev` ëª¨ë“œ(Next.js dev ì„œë²„)ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong>[ì‹œìŠ¤í…œ 2] 'í•µì‹¬ ë°±ì—”ë“œ' (DevOps + ì±—ë´‡ API)</strong>
            <ul>
                <li><strong>ëª©ì :</strong> 'ë°°í¬ ê¸°ê³„'ì´ì 'ì±—ë´‡ API' ì„œë²„. (ëª¨ë“  ë°±ì—”ë“œ í†µí•©)</li>
                <li><strong>ì†ŒìŠ¤ì½”ë“œ:</strong> <code>Repo 2: SB_Hackathon_Cherry_Deploy</code></li>
                <li><strong>ì‹¤í–‰ (PM2):</strong> <code>pm2 start "uvicorn app_main:app --host 0.0.0.0 --port 9001" --name main-api</code></li>
            </ul>
        </li>
    </ul>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">3. [ì‹œìŠ¤í…œ 2] í•µì‹¬ API ëª…ì„¸ (Swagger)</h2>
    <p style="font-size: 16px;">(<code>app_main.py</code>ì— êµ¬í˜„í•  API ëª©ë¡)</p>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong><code>POST /api/v1/deploy</code> (DevOps API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> 'ì±—ë´‡ í”„ë¡ íŠ¸ì—”ë“œ'ì˜ ì‹ ê·œ ë°°í¬ë¥¼ ë¹„ë™ê¸°ë¡œ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.</li>
                <li><strong>Request Body (ìˆ˜ì •ë¨):</strong> 
                    <pre style="background-color: #f4f4f4; padding: 10px; border-radius: 5px; font-size: 14px;">
{
    "branch": "main"
}
                    </pre>
                </li>
            </ul>
        </li>
        <li><strong><code>POST /api/v1/rollback</code> (DevOps API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> 'ì±—ë´‡ í”„ë¡ íŠ¸ì—”ë“œ'ë¥¼ ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±í•©ë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong><code>GET /api/v1/status/{task_id}</code> (DevOps API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> ë°°í¬/ë¡¤ë°± ì‘ì—…ì˜ í˜„ì¬ ìƒíƒœë¥¼ í´ë§(Polling)í•©ë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong><code>GET /api/v1/preview</code> (DevOps API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> ìµœê·¼ ì„±ê³µ ë°°í¬ ëŒ€ë¹„ Git diffë¥¼ ìˆ˜ì§‘í•´ ì˜ˆìƒ ëª…ë ¹ ëª©ë¡, ë‹¨ê³„ë³„ ETA, Blue/Green í˜„í™©, ìœ„í—˜ë„, Gemini 2.5 Flash ìš”ì•½ì„ ëŒë ¤ì¤ë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong><code>POST /api/v1/chat</code> (ì±—ë´‡ API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> ì±—ë´‡ UIê°€ í˜¸ì¶œí•  ê°„ë‹¨í•œ LLM APIì…ë‹ˆë‹¤.</li>
                <li><strong>Request Body:</strong> <code>{ "message": "string" }</code></li>
            </ul>
        </li>
        <li><strong><code>GET /api/v1/tasks/recent</code>, <code>GET /api/v1/tasks/{task_id}/logs</code></strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> ìµœê·¼ ë°°í¬/ë¡¤ë°± ì‘ì—… ìš”ì•½ê³¼ ê° ë‹¨ê³„(stdout/stderr í¬í•¨) ë¡œê·¸ ì¡°íšŒë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong><code>GET /healthz</code></strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> MongoDB ì—°ê²°, PM2(`main-api`, `frontend-dev`) ìƒíƒœ, Blue/Green ìŠ¬ë¡¯ì„ ë™ì‹œì— ì ê²€í•©ë‹ˆë‹¤.</li>
            </ul>
        </li>
    </ul>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">4. í•„ìˆ˜ EC2 í™˜ê²½ ë° ì„¤ì¹˜ (EC2 ì²´í¬ë¦¬ìŠ¤íŠ¸)</h2>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>Python 3.12:</strong> EC2 ì „ì—­ì— ì„¤ì¹˜ëœ Python 3.12ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
        <li><strong>Node.js / npm:</strong> (<code>npm install -g pm2</code> ë° <code>SB_Hackathon_Cherry_Chatbot</code> ë¹Œë“œì— í•„ìš”)</li>
        <li><strong>Nginx:</strong> (<code>sudo apt install nginx</code>. ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ë° Blue/Green íŠ¸ë˜í”½ ì „í™˜ìš©)</li>
        <li><strong>PM2:</strong> (<code>npm install -g pm2</code>. <code>main-api</code> ê´€ë¦¬ìš©)</li>
        <li><strong>MongoDB:</strong> (<code>./mongodb</code> ë””ë ‰í„°ë¦¬ì— ì••ì¶• í•´ì œëœ ë°”ì´ë„ˆë¦¬ë¥¼ ì‚¬ìš©í•˜ë©°, <code>./mongodb/bin/mongod --dbpath mongodb-data --bind_ip 127.0.0.1 --port 27017 --fork --logpath mongodb-data/mongod.log</code> ëª…ë ¹ìœ¼ë¡œ ì‹¤í–‰)</li>
        <li><strong>Git:</strong> (<code>sudo apt install git</code>. ì†ŒìŠ¤ì½”ë“œ <code>pull</code>ìš©)</li>
    </ul>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">5. DB ì„¤ê³„ (MongoDB) (ìˆ˜ì •ë¨)</h2>
    <ol style="margin-left: 20px; font-size: 16px;">
        <li><strong><code>deploy_tasks</code> (ë°°í¬ ì‘ì—… ê´€ë¦¬)</strong>
            <ul>
                <li><code>task_id</code> (string, Pkey): UUID</li>
                <li><code>status</code> (string: "pending", "running_clone", "running_build", "running_cutover", "<strong>running_observability</strong>"(Preview ìš”ì•½ ë‹¨ê³„), "completed", "failed")</li>
                <li><code>started_at</code> (datetime)</li>
                <li><code>completed_at</code> (datetime)</li>
                <li><code>error_log</code> (string)</li>
                <li><code>metadata</code> (object): ë¸Œëœì¹˜ ì •ë³´ ë° ê° ë‹¨ê³„ë³„ ë©”íƒ€ë°ì´í„°</li>
            </ul>
        </li>
    </ol>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">6. [ì‹œìŠ¤í…œ 2] í•µì‹¬ ë°°í¬ ë¡œì§ (<code>POST /deploy</code>) (ìˆ˜ì •ë¨)</h2>
    <p style="font-size: 16px;">
        (<code>app_main.py</code>ì˜ <code>BackgroundTasks</code> ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë  ì‹¤ì œ ìˆœì„œì…ë‹ˆë‹¤.)
    </p>

    <ol style="margin-left: 20px; font-size: 16px;">
        <li><strong>ì¦‰ì‹œ ì‘ë‹µ:</strong> <code>task_id</code>ë¥¼ ìƒì„±, ë¸Œëœì¹˜ ì •ë³´ì™€ í•¨ê»˜ DBì— "pending"ìœ¼ë¡œ ì €ì¥ í›„, <code>task_id</code>ë¥¼ ì¦‰ì‹œ í”„ë¡ íŠ¸ì— ë°˜í™˜í•©ë‹ˆë‹¤.</li>
        <li><strong>(ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘)</strong></li>
        <li><strong>DB ìƒíƒœ "running_clone":</strong> <code>subprocess</code>ë¡œ <strong><code>Repo 1 (Chatbot)</code></strong>ì˜ ì›Œí‚¹ ë””ë ‰í„°ë¦¬ë¥¼ ì•„ë˜ ìˆœì„œë¡œ ì™„ì „íˆ êµì²´í•©ë‹ˆë‹¤. (ì˜µì…˜ìœ¼ë¡œ <code>main</code> í—ˆìš©)
            <ul>
                <li><code>git fetch origin</code></li>
                <li><code>git checkout -B [branch] origin/[branch]</code></li>
                <li><code>git reset --hard origin/[branch]</code></li>
                <li><code>git clean -fdx</code></li>
            </ul>
            <ul>
                <li><strong>(ì‹¤í–‰ ê²½ë¡œ: <code>cwd="/home/ec2-user/projects/SB_Hackathon_Cherry_Chatbot/"</code>)</strong></li>
            </ul>
        </li>
        <li><strong>DB ìƒíƒœ "running_build":</strong>
            <ul>
                <li><code>subprocess</code>ë¡œ <strong><code>npm install</code> â†’ <code>npm run build</code> â†’ <code>npm run export</code></strong>ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ê° ëª…ë ¹ì€ <code>FRONTEND_INSTALL_COMMAND</code>, <code>FRONTEND_BUILD_COMMAND</code>, <code>FRONTEND_EXPORT_COMMAND</code>ë¡œ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li><strong>(ì‹¤í–‰ ê²½ë¡œ: <code>cwd="/home/ec2-user/projects/SB_Hackathon_Cherry_Chatbot/frontend/my-dashboard/"</code>)</strong></li>
            </ul>
        </li>
        <li><strong>DB ìƒíƒœ "running_cutover":</strong>
            <ul>
                <li><code>FRONTEND_BUILD_OUTPUT_SUBDIR</code>(ê¸°ë³¸ê°’ <code>out/</code>)ì´ ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ í˜„ì¬ Live ìŠ¬ë¡¯ì„ í™•ì¸í•´ ë°˜ëŒ€ ìŠ¬ë¡¯(Blue â†” Green)ì— ì •ì  ì‚°ì¶œë¬¼ì„ ë³µì‚¬í•˜ê³ , <code>current</code> ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ìƒˆ ìŠ¬ë¡¯ìœ¼ë¡œ ìŠ¤ì™‘í•©ë‹ˆë‹¤. Dry-run ëª¨ë“œì—ì„œëŠ” ê³„ì‚°ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong>DB ìƒíƒœ "running_observability":</strong> í˜„ì¬ ë²„ì „ì€ "Observability checks are not implemented yet." ë©”ì‹œì§€ë¥¼ ê¸°ë¡í•´ë‘ê³  ì¶”í›„ í™•ì¥ì„ ìœ„í•œ ìë¦¬ë¥¼ í™•ë³´í•©ë‹ˆë‹¤.</li>
        <li><strong>DB ìƒíƒœ "completed":</strong> ì´ì „ 'Blue' í™˜ê²½ì„ ì •ë¦¬í•˜ê³  ì‘ì—…ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.</li>
        <li><strong>ì‹¤íŒ¨ ì²˜ë¦¬:</strong> <code>npm install</code> ë‹¨ê³„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì„œë¹„ìŠ¤ê°€ ì¦‰ì‹œ ì§ì „ ì„±ê³µ ë°°í¬ ì»¤ë°‹ìœ¼ë¡œ ìë™ ë¡¤ë°±ì„ ì‹œë„í•˜ê³ , ê²°ê³¼ë¥¼ ì›ë³¸ Task ë©”íƒ€ë°ì´í„°ì˜ <code>failure_context.auto_recovery</code>ì— ê¸°ë¡í•©ë‹ˆë‹¤.</li>
    </ol>
    <p style="font-size: 16px; color: #555;">â€» í˜„ì¬ ê¸°ë³¸ê°’ì€ <code>DEPLOY_DRY_RUN=false</code>ë¼ì„œ ìœ„ ëª…ë ¹ë“¤ì´ ì‹¤ì œ ì‹¤í–‰ë©ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜ë§Œ ì›í•˜ë©´ PM2/í™˜ê²½ë³€ìˆ˜ì—ì„œ <code>DEPLOY_DRY_RUN=true</code>ë¡œ ì„¤ì •í•œ ë’¤ ì¬ì‹œì‘í•˜ì„¸ìš”.</p>
    
    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">7. Git ë¦¬í¬ì§€í† ë¦¬ ë° ë¸Œëœì¹˜ ì „ëµ (ìˆ˜ì •ë¨)</h2>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>ë¦¬í¬ì§€í† ë¦¬ êµ¬ì¡°:</strong> 2ê°œì˜ ë…ë¦½ëœ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
            <ul>
                <li><strong><code>Repo 1: SB_Hackathon_Cherry_Chatbot</code></strong> (ë°°í¬ë  'ì œí’ˆ')</li>
                <li><strong><code>Repo 2: SB_Hackathon_Cherry_Deploy</code></strong> ('ë°°í¬ ê¸°ê³„' + ì±—ë´‡ API)</li>
            </ul>
        </li>
        <li><strong>ì›Œí¬í”Œë¡œìš°:</strong>
            <ul>
                <li><strong><code>sungwoo/feature/backend-mvp</code>:</strong> ì„±ìš°ë‹˜ì´ <strong><code>Repo 2 (Deploy)</code></strong>ì—ì„œ 'ë°°í¬ ê¸°ê³„'ì™€ 'ì±—ë´‡ API'ë¥¼ ê°œë°œí•˜ëŠ” **'ê°œë°œ ë¸Œëœì¹˜'**ì…ë‹ˆë‹¤.</li>
                <li><strong><code>deploy</code> (in <code>Repo 1</code>):</strong>
                    <ul>
                        <li>[ì‹œìŠ¤í…œ 2]ê°€ <code>git pull</code> í•  ê¸°ë³¸ **'ë°°í¬ ëŒ€ìƒ ë¸Œëœì¹˜'**ì…ë‹ˆë‹¤.</li>
                        <li>í•„ìš” ì‹œ <code>main</code> ë¸Œëœì¹˜ë„ í—ˆìš©í•˜ì§€ë§Œ, ê¸°ë³¸ì€ <code>deploy</code>ì…ë‹ˆë‹¤.</li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>

    <h2 style="font-size: 22px; margin-top: 30px;">8. ë¡¤ë°± ì „ëµ</h2>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>ìš”ì²­:</strong> <code>POST /api/v1/rollback</code> (ê¸°ë³¸ ë¸Œëœì¹˜: <code>deploy</code>, ì˜µì…˜ìœ¼ë¡œ <code>main</code>)</li>
        <li><strong>ê²€ì¦:</strong> MongoDBì—ì„œ ìµœê·¼ 2ê°œì˜ ì„±ê³µ ë°°í¬ íˆìŠ¤í† ë¦¬ë¥¼ ì¡°íšŒ (commit SHA í¬í•¨). ì„±ê³µ ê¸°ë¡ì´ 2ê±´ ë¯¸ë§Œì´ë©´ 409ë¡œ ì¢…ë£Œë©ë‹ˆë‹¤.</li>
        <li><strong>ë™ì‘:</strong> ìµœì‹  ì„±ê³µ commitì„ <code>from_commit</code>, ì§ì „ ì„±ê³µ commitì„ <code>to_commit</code>ìœ¼ë¡œ ì‚¼ì•„ ì•„ë˜ ëª…ë ¹ ì‹¤í–‰:
            <ul>
                <li><code>git fetch origin</code></li>
                <li><code>git checkout -B [branch] to_commit</code></li>
                <li><code>git reset --hard to_commit</code></li>
                <li><code>git clean -fdx</code></li>
                <li><code>git push origin +to_commit:[branch]</code> (ì‹¤ì œ ëª¨ë“œì—ì„œë§Œ)</li>
                <li><code>npm install â†’ npm run build â†’ npm run export</code> ì‹¤í–‰ í›„ Blue/Green ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ë™ì¼í•˜ê²Œ ë³µêµ¬</li>
            </ul>
        </li>
        <li><strong>ê²°ê³¼:</strong> <code>/api/v1/status/{task_id}</code>ë¡œ ë¡¤ë°± ì§„í–‰ ìƒí™©ê³¼ <code>rolled_back_from/rolled_back_to</code> ë©”íƒ€ë°ì´í„°ë¥¼ í™•ì¸.</li>
        <li><strong>ì£¼ì˜:</strong> Repo1 <code>deploy</code> ë¸Œëœì¹˜ì—ëŠ” ë°°í¬ ëŒ€ìƒì¸ <code>frontend/my-dashboard</code>ë§Œ í¬í•¨ì‹œí‚¤ê³ , ê¸°íƒ€ ë””ë ‰í„°ë¦¬ëŠ” ë³„ë„ ë¸Œëœì¹˜ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.</li>
        <li><strong>Preview:</strong> <code>GET /api/v1/preview</code>ëŠ” ìµœê·¼ ì„±ê³µ ë°°í¬ ëŒ€ë¹„ Git diffë¥¼ Gemini 2.5 Flash ëª¨ë¸ë¡œ ìš”ì•½í•´ ë³€ê²½ ì ê²€ ë…¸íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li>
    </ul>

</div>
