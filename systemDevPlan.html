<div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; padding: 20px; max-width: 900px; margin: auto; background-color: #ffffff; color: #333; border: 1px solid #ddd;">

    <h1 style="border-bottom: 2px solid #000; padding-bottom: 10px; font-size: 28px;">
        ğŸš€ "Delightful Deploy" API ë°±ì—”ë“œ ìµœì¢… êµ¬í˜„ ê³„íšì„œ (2-Repo)
    </h1>

    <h2 style="font-size: 22px; margin-top: 30px;">1. í•µì‹¬ ì›ì¹™: 2-Repo (Polyrepo) êµ¬ì¡°</h2>
    <p style="font-size: 16px;">
        ìš°ë¦¬ëŠ” 'ë°°í¬ë  ì œí’ˆ'ê³¼ 'ë°°í¬ ë„êµ¬'ë¥¼ <strong>2ê°œì˜ ë…ë¦½ëœ ë¦¬í¬ì§€í† ë¦¬</strong>ë¡œ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ ë°©ì‹ì€ EC2ì—ì„œì˜ ê°œë°œ/ë””ë²„ê¹… ì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” <strong>Git ì¶©ëŒì„ ì›ì²œì ìœ¼ë¡œ ë°©ì§€</strong>í•©ë‹ˆë‹¤.
    </p>
    
    <h3 style="font-size: 19px; margin-top: 25px; margin-bottom: 10px;">EC2 ë¦¬í¬ì§€í† ë¦¬ í´ë” êµ¬ì¡°</h3>
    <pre style="background-color: #f4f4f4; padding: 15px; border-radius: 5px; font-family: monospace;">
/home/ec2-user/projects/
â”‚
â”œâ”€â”€ SB_Hackathon_Cherry_Chatbot/   # &lt;--- (Repo 1) ë°°í¬ë  'ì œí’ˆ' (ì±—ë´‡ í”„ë¡ íŠ¸ì—”ë“œ)
â”‚
â””â”€â”€ SB_Hackathon_Cherry_Deploy/    # &lt;--- (Repo 2) ìš°ë¦¬ì˜ 'ë„êµ¬' (ëª¨ë“  ë°±ì—”ë“œ)
    â”‚
    â”œâ”€â”€ app_main.py                # (DevOps API + ì±—ë´‡ APIê°€ ëª¨ë‘ ì´ íŒŒì¼ì—!)
    â”œâ”€â”€ requirements.txt
    â””â”€â”€ ...
</pre>

    <h2 style="font-size: 22px; margin-top: 30px;">2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (ë‹¨ìˆœí™”ë¨)</h2>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>[ì‹œìŠ¤í…œ 1] ë°°í¬ë  'ìƒ˜í”Œ ì•±' (ì±—ë´‡ í”„ë¡ íŠ¸ì—”ë“œ)</strong>
            <ul>
                <li><strong>ëª©ì :</strong> ë°°í¬/ë¡¤ë°±ì„ ì‹œì—°í•˜ê¸° ìœ„í•œ íƒ€ê²Ÿ.</li>
                <li><strong>ì†ŒìŠ¤ì½”ë“œ:</strong> <code>Repo 1: SB_Hackathon_Cherry_Chatbot</code></li>
                <li><strong>í”„ë ˆì„ì›Œí¬:</strong> Next.js ì•± (ë£¨íŠ¸: <code>frontend/my-dashboard</code>). êµ¬ì¡° ì •ë¹„ ì™„ë£Œë¡œ <code>npm install</code>, <code>npm run dev</code>, <code>npm run build</code>ê°€ ë™ì‘í•©ë‹ˆë‹¤.</li>
                <li><strong>ì‹¤í–‰:</strong> [ì‹œìŠ¤í…œ 2]ê°€ <code>npm install</code>ì„ ìˆ˜í–‰í•œ ë’¤ PM2ë¡œ <code>npm run dev</code>ë¥¼ ë°±ê·¸ë¼ìš´ë“œ(`frontend-dev`)ì— ê¸°ë™í•©ë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong>[ì‹œìŠ¤í…œ 2] 'í•µì‹¬ ë°±ì—”ë“œ' (DevOps + ì±—ë´‡ API)</strong>
            <ul>
                <li><strong>ëª©ì :</strong> 'ë°°í¬ ê¸°ê³„'ì´ì 'ì±—ë´‡ API' ì„œë²„. (ëª¨ë“  ë°±ì—”ë“œ í†µí•©)</li>
                <li><strong>ì†ŒìŠ¤ì½”ë“œ:</strong> <code>Repo 2: SB_Hackathon_Cherry_Deploy</code></li>
                <li><strong>ì‹¤í–‰ (PM2):</strong> <code>pm2 start /home/ec2-user/projects/SB_Hackathon_Cherry_Deploy/app_main.py --name main-api --port 9001</code></li>
            </ul>
        </li>
    </ul>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">3. [ì‹œìŠ¤í…œ 2] í•µì‹¬ API ëª…ì„¸ (Swagger)</h2>
    <p style="font-size: 16px;">(<code>app_main.py</code>ì— êµ¬í˜„í•  API ëª©ë¡)</p>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong><code>POST /api/v1/deploy</code> (DevOps API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> 'ì±—ë´‡ í”„ë¡ íŠ¸ì—”ë“œ'ì˜ ì‹ ê·œ ë°°í¬ë¥¼ ë¹„ë™ê¸°ë¡œ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.</li>
                <li><strong>Request Body (ìˆ˜ì •ë¨):</strong> 
                    <pre style="background-color: #f4f4f4; padding: 10px; border-radius: 5px; font-size: 14px;">
{
    "branch": "upload"
}
                    </pre>
                </li>
            </ul>
        </li>
        <li><strong><code>POST /api/v1/rollback</code> (DevOps API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> 'ì±—ë´‡ í”„ë¡ íŠ¸ì—”ë“œ'ë¥¼ ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±í•©ë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong><code>GET /api/v1/status/{task_id}</code> (DevOps API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> ë°°í¬/ë¡¤ë°± ì‘ì—…ì˜ í˜„ì¬ ìƒíƒœë¥¼ í´ë§(Polling)í•©ë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong><code>GET /api/v1/preview</code> (DevOps API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> ë°°í¬ ì „ ì˜ˆìƒ ë¹„ìš©/ë¦¬ìŠ¤í¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. (MVPëŠ” í•˜ë“œì½”ë”©)</li>
            </ul>
        </li>
        <li><strong><code>POST /api/v1/chat</code> (ì±—ë´‡ API)</strong>
            <ul>
                <li><strong>ì„¤ëª…:</strong> ì±—ë´‡ UIê°€ í˜¸ì¶œí•  ê°„ë‹¨í•œ LLM APIì…ë‹ˆë‹¤.</li>
                <li><strong>Request Body:</strong> <code>{ "message": "string" }</code></li>
            </ul>
        </li>
    </ul>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">4. í•„ìˆ˜ EC2 í™˜ê²½ ë° ì„¤ì¹˜ (EC2 ì²´í¬ë¦¬ìŠ¤íŠ¸)</h2>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>Python 3.12:</strong> EC2 ì „ì—­ì— ì„¤ì¹˜ëœ Python 3.12ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
        <li><strong>Node.js / npm:</strong> (<code>npm install -g pm2</code> ë° <code>SB_Hackathon_Cherry_Chatbot</code> <code>build</code>ì— í•„ìš”)</li>
        <li><strong>Nginx:</strong> (<code>sudo apt install nginx</code>. ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ë° Blue/Green íŠ¸ë˜í”½ ì „í™˜ìš©)</li>
        <li><strong>PM2:</strong> (<code>npm install -g pm2</code>. <code>main-api</code> ê´€ë¦¬ìš©)</li>
        <li><strong>MongoDB:</strong> (<code>sudo apt install mongodb</code>. ë°°í¬ ì´ë ¥ ë° ë¦¬í¬íŠ¸ ì €ì¥ìš©)</li>
        <li><strong>Git:</strong> (<code>sudo apt install git</code>. ì†ŒìŠ¤ì½”ë“œ <code>pull</code>ìš©)</li>
    </ul>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">5. DB ì„¤ê³„ (MongoDB) (ìˆ˜ì •ë¨)</h2>
    <ol style="margin-left: 20px; font-size: 16px;">
        <li><strong><code>deploy_tasks</code> (ë°°í¬ ì‘ì—… ê´€ë¦¬)</strong>
            <ul>
                <li><code>task_id</code> (string, Pkey): UUID</li>
                <li><code>status</code> (string: "pending", "running_clone", "running_build", "running_cutover", "<strong>running_observability</strong>"(Preview ìš”ì•½ ë‹¨ê³„), "completed", "failed")</li>
                <li><code>started_at</code> (datetime)</li>
                <li><code>completed_at</code> (datetime)</li>
                <li><code>error_log</code> (string)</li>
                <li><code>metadata</code> (object): ë¸Œëœì¹˜ ì •ë³´ ë° ê° ë‹¨ê³„ë³„ ë©”íƒ€ë°ì´í„°</li>
            </ul>
        </li>
    </ol>

    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">6. [ì‹œìŠ¤í…œ 2] í•µì‹¬ ë°°í¬ ë¡œì§ (<code>POST /deploy</code>) (ìˆ˜ì •ë¨)</h2>
    <p style="font-size: 16px;">
        (<code>app_main.py</code>ì˜ <code>BackgroundTasks</code> ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë  ì‹¤ì œ ìˆœì„œì…ë‹ˆë‹¤.)
    </p>

    <ol style="margin-left: 20px; font-size: 16px;">
        <li><strong>ì¦‰ì‹œ ì‘ë‹µ:</strong> <code>task_id</code>ë¥¼ ìƒì„±, ë¸Œëœì¹˜ ì •ë³´ì™€ í•¨ê»˜ DBì— "pending"ìœ¼ë¡œ ì €ì¥ í›„, <code>task_id</code>ë¥¼ ì¦‰ì‹œ í”„ë¡ íŠ¸ì— ë°˜í™˜í•©ë‹ˆë‹¤.</li>
        <li><strong>(ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘)</strong></li>
        <li><strong>DB ìƒíƒœ "running_clone":</strong> <code>subprocess</code>ë¡œ <strong><code>Repo 1 (Chatbot)</code></strong>ì˜ ì›Œí‚¹ ë””ë ‰í„°ë¦¬ë¥¼ ì•„ë˜ ìˆœì„œë¡œ ì™„ì „íˆ êµì²´í•©ë‹ˆë‹¤. (ì˜µì…˜ìœ¼ë¡œ <code>main</code> í—ˆìš©)
            <ul>
                <li><code>git fetch origin</code></li>
                <li><code>git checkout -B [branch] origin/[branch]</code></li>
                <li><code>git reset --hard origin/[branch]</code></li>
                <li><code>git clean -fdx</code></li>
            </ul>
            <ul>
                <li><strong>(ì‹¤í–‰ ê²½ë¡œ: <code>cwd="/home/ec2-user/projects/SB_Hackathon_Cherry_Chatbot/"</code>)</strong></li>
            </ul>
        </li>
        <li><strong>DB ìƒíƒœ "running_build":</strong>
            <ul>
                <li><code>subprocess</code>ë¡œ <strong><code>npm install</code></strong>ì„ ì‹¤í–‰í•œ ë’¤, ê¸°ë³¸ê°’ìœ¼ë¡œ <code>pm2 start npm --name frontend-dev -- run dev</code>ë¥¼ í˜¸ì¶œí•´ ê°œë°œ ì„œë²„ë¥¼ ë„ì›ë‹ˆë‹¤. í•„ìš”í•˜ë©´ <code>FRONTEND_BUILD_COMMAND</code> í™˜ê²½ë³€ìˆ˜ë¡œ ëª…ë ¹ì„ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li><strong>(ì‹¤í–‰ ê²½ë¡œ: <code>cwd="/home/ec2-user/projects/SB_Hackathon_Cherry_Chatbot/frontend/my-dashboard/"</code>)</strong></li>
            </ul>
        </li>
        <li><strong>DB ìƒíƒœ "running_cutover":</strong>
            <ul>
                <li>í˜„ì¬ ê¸°ë³¸ ëª¨ë“œëŠ” ê°œë°œ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” ê´€ê³„ë¡œ ì»·ì˜¤ë²„ ë‹¨ê³„ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤. ì •ì  ì‚°ì¶œë¬¼ì´ í•„ìš”í•œ ê²½ìš° í™˜ê²½ë³€ìˆ˜ë¡œ ì¶œë ¥ ë””ë ‰í„°ë¦¬ë¥¼ ì§€ì •í•˜ë©´ ì´ ë‹¨ê³„ê°€ í™œì„±í™”ë©ë‹ˆë‹¤.</li>
            </ul>
        </li>
        <li><strong>DB ìƒíƒœ "running_observability":</strong> Preview APIê°€ git diffë¥¼ ìˆ˜ì§‘í•˜ê³  Gemini 2.5 Flashë¡œ ìš”ì•½ì„ ìƒì„±í•©ë‹ˆë‹¤.</li>
        <li><strong>DB ìƒíƒœ "completed":</strong> ì´ì „ 'Blue' í™˜ê²½ì„ ì •ë¦¬í•˜ê³  ì‘ì—…ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.</li>
        <li><strong>ì‹¤íŒ¨ ì²˜ë¦¬:</strong> <code>npm install</code> ë˜ëŠ” PM2 dev ê¸°ë™ ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨í•˜ë©´ ì„œë¹„ìŠ¤ê°€ ì¦‰ì‹œ ì§ì „ ì„±ê³µ ë°°í¬ ì»¤ë°‹ìœ¼ë¡œ ìë™ ë¡¤ë°±ì„ ì‹œë„í•˜ê³ , ê²°ê³¼ë¥¼ ì›ë³¸ Task ë©”íƒ€ë°ì´í„°ì˜ <code>failure_context.auto_recovery</code>ì— ê¸°ë¡í•©ë‹ˆë‹¤.</li>
    </ol>
    <p style="font-size: 16px; color: #555;">â€» í˜„ì¬ ê¸°ë³¸ê°’ì€ <code>DEPLOY_DRY_RUN=false</code>ë¼ì„œ ìœ„ ëª…ë ¹ë“¤ì´ ì‹¤ì œ ì‹¤í–‰ë©ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜ë§Œ ì›í•˜ë©´ PM2/í™˜ê²½ë³€ìˆ˜ì—ì„œ <code>DEPLOY_DRY_RUN=true</code>ë¡œ ì„¤ì •í•œ ë’¤ ì¬ì‹œì‘í•˜ì„¸ìš”.</p>
    
    <hr style="margin-top: 35px; margin-bottom: 35px; border: 0; border-top: 1px solid #eee;">

    <h2 style="font-size: 22px; margin-top: 30px;">7. Git ë¦¬í¬ì§€í† ë¦¬ ë° ë¸Œëœì¹˜ ì „ëµ (ìˆ˜ì •ë¨)</h2>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>ë¦¬í¬ì§€í† ë¦¬ êµ¬ì¡°:</strong> 2ê°œì˜ ë…ë¦½ëœ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
            <ul>
                <li><strong><code>Repo 1: SB_Hackathon_Cherry_Chatbot</code></strong> (ë°°í¬ë  'ì œí’ˆ')</li>
                <li><strong><code>Repo 2: SB_Hackathon_Cherry_Deploy</code></strong> ('ë°°í¬ ê¸°ê³„' + ì±—ë´‡ API)</li>
            </ul>
        </li>
        <li><strong>ì›Œí¬í”Œë¡œìš°:</strong>
            <ul>
                <li><strong><code>sungwoo/feature/backend-mvp</code>:</strong> ì„±ìš°ë‹˜ì´ <strong><code>Repo 2 (Deploy)</code></strong>ì—ì„œ 'ë°°í¬ ê¸°ê³„'ì™€ 'ì±—ë´‡ API'ë¥¼ ê°œë°œí•˜ëŠ” **'ê°œë°œ ë¸Œëœì¹˜'**ì…ë‹ˆë‹¤.</li>
                <li><strong><code>deploy</code> (in <code>Repo 1</code>):</strong>
                    <ul>
                        <li>[ì‹œìŠ¤í…œ 2]ê°€ <code>git pull</code> í•  ê¸°ë³¸ **'ë°°í¬ ëŒ€ìƒ ë¸Œëœì¹˜'**ì…ë‹ˆë‹¤.</li>
                        <li>í•„ìš” ì‹œ <code>main</code> ë¸Œëœì¹˜ë„ í—ˆìš©í•˜ì§€ë§Œ, ê¸°ë³¸ì€ <code>deploy</code>ì…ë‹ˆë‹¤.</li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>

    <h2 style="font-size: 22px; margin-top: 30px;">8. ë¡¤ë°± ì „ëµ</h2>
    <ul style="margin-left: 20px; font-size: 16px;">
        <li><strong>ìš”ì²­:</strong> <code>POST /api/v1/rollback</code> (ê¸°ë³¸ ë¸Œëœì¹˜: <code>deploy</code>, ì˜µì…˜ìœ¼ë¡œ <code>main</code>)</li>
        <li><strong>ê²€ì¦:</strong> MongoDBì—ì„œ ìµœê·¼ 2ê°œì˜ ì„±ê³µ ë°°í¬ íˆìŠ¤í† ë¦¬ë¥¼ ì¡°íšŒ (commit SHA í¬í•¨). ì„±ê³µ ê¸°ë¡ì´ 2ê±´ ë¯¸ë§Œì´ë©´ 409ë¡œ ì¢…ë£Œë©ë‹ˆë‹¤.</li>
        <li><strong>ë™ì‘:</strong> ìµœì‹  ì„±ê³µ commitì„ <code>from_commit</code>, ì§ì „ ì„±ê³µ commitì„ <code>to_commit</code>ìœ¼ë¡œ ì‚¼ì•„ ì•„ë˜ ëª…ë ¹ ì‹¤í–‰:
            <ul>
                <li><code>git fetch origin</code></li>
                <li><code>git checkout -B [branch] to_commit</code></li>
                <li><code>git reset --hard to_commit</code></li>
                <li><code>git clean -fdx</code></li>
                <li><code>git push origin +to_commit:[branch]</code> (ì‹¤ì œ ëª¨ë“œì—ì„œë§Œ)</li>
                <li><code>npm install</code> í›„ PM2 `npm run dev` ëª…ë ¹ì„ ì¬ì ìš©</li>
            </ul>
        </li>
        <li><strong>ê²°ê³¼:</strong> <code>/api/v1/status/{task_id}</code>ë¡œ ë¡¤ë°± ì§„í–‰ ìƒí™©ê³¼ <code>rolled_back_from/rolled_back_to</code> ë©”íƒ€ë°ì´í„°ë¥¼ í™•ì¸.</li>
        <li><strong>ì£¼ì˜:</strong> Repo1 <code>deploy</code> ë¸Œëœì¹˜ì—ëŠ” ë°°í¬ ëŒ€ìƒì¸ <code>frontend/my-dashboard</code>ë§Œ í¬í•¨ì‹œí‚¤ê³ , ê¸°íƒ€ ë””ë ‰í„°ë¦¬ëŠ” ë³„ë„ ë¸Œëœì¹˜ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.</li>
        <li><strong>Preview:</strong> <code>GET /api/v1/preview</code>ëŠ” ìµœê·¼ ì„±ê³µ ë°°í¬ ëŒ€ë¹„ Git diffë¥¼ Gemini 2.5 Flash ëª¨ë¸ë¡œ ìš”ì•½í•´ ë³€ê²½ ì ê²€ ë…¸íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li>
    </ul>

</div>
